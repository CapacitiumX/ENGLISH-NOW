<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeuroLingua V310 - Recuperado</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';</script>

    <style>
        :root {
            --primary: #8b5cf6; --accent: #06b6d4; --dark: #0f172a; --panel: #1e293b;
            --text: #f1f5f9; --green: #22c55e; --red: #ef4444;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: var(--text); margin: 0; height: 100vh; display: flex; overflow: hidden; }
        .layout { display: flex; width: 100%; height: 100%; }
        
        /* IZQUIERDA */
        .left-panel { width: 400px; background: var(--panel); border-right: 1px solid #334155; display: flex; flex-direction: column; padding: 15px; gap: 10px; }
        .brand { font-size: 1.4rem; font-weight: 900; color: var(--accent); text-align: center; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 2px;}
        .config-box { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; border: 1px solid #334155; }
        .row { display: flex; gap: 5px; margin-bottom: 5px; align-items: center; }
        input, select { background: #0f172a; color: white; border: 1px solid #475569; padding: 8px; border-radius: 4px; width: 100%; font-size: 0.85rem; }
        button { cursor: pointer; padding: 8px; border-radius: 4px; border: none; font-weight: bold; color: white; font-size: 0.8rem; transition: 0.2s; flex: 1; }
        button:active { transform: scale(0.98); }
        .btn-green { background: var(--green); } .btn-blue { background: #3b82f6; } .btn-red { background: var(--red); }
        .btn-purple { background: var(--primary); } .btn-orange { background: #f59e0b; color: black; }
        .btn-trash-small { flex: 0 0 40px; background: var(--red); font-size: 1.2rem; }

        /* LISTA */
        .list-header { font-size: 0.8rem; color: #94a3b8; display: flex; justify-content: space-between; margin-top:5px; }
        .words-list-container { flex: 1; overflow-y: auto; background: #0f172a; border: 1px solid #334155; border-radius: 5px; padding: 5px; }
        .list-item { padding: 8px 10px; border-bottom: 1px solid #1e293b; font-size: 0.9rem; display: flex; justify-content: space-between; cursor: pointer; align-items: center; }
        .list-item:hover { background: #1e293b; }
        .list-item.active { background: var(--primary); color: white; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-left: 5px; }
        .dot-red { background: var(--red); box-shadow: 0 0 5px var(--red); }
        .dot-green { background: var(--green); box-shadow: 0 0 5px var(--green); }

        /* DERECHA */
        .right-panel { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .top-review-bar { position: absolute; top: 20px; right: 20px; z-index: 10; }
        .btn-review-red { background: var(--red); padding: 10px 20px; border-radius: 30px; font-weight: bold; cursor: pointer; color: white; border: none; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); display: none; animation: pulse 2s infinite; }
        
        .flashcard { width: 100%; max-width: 750px; height: 85vh; background: #1e293b; border: 1px solid #334155; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7); position: relative; }
        
        /* IMAGEN NORMAL (CONTAIN) */
        .img-area { flex: 4; background: #000; width: 100%; overflow: hidden; position: relative; display: flex; align-items: center; justify-content: center; }
        .real-img { width: 100%; height: 100%; object-fit: contain; }
        
        .info-area { flex: 3; padding: 10px 30px; text-align: center; display: flex; flex-direction: column; justify-content: center; background: linear-gradient(to top, #1e293b 95%, transparent 100%); }
        .word-en { font-size: 3.5rem; font-weight: 900; margin: 0; color: white; line-height: 1; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
        .word-pho { font-size: 1.1rem; color: #94a3b8; font-family: monospace; margin: 5px 0; }
        .word-es { font-size: 2.2rem; color: var(--accent); margin: 5px 0; font-weight: bold; text-transform: uppercase; min-height: 40px; cursor: text; border-bottom: 1px dashed rgba(255,255,255,0.1); }
        .word-es:focus { border-bottom: 1px solid var(--accent); outline: none; }

        .sentence-area { margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; text-align: left; font-size: 1.1rem; border: 1px solid rgba(255,255,255,0.1); }
        .sent-en { color: #f8fafc; font-style: italic; margin-bottom: 8px; font-weight: 500; display: block; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px;}
        .sent-es { color: #94a3b8; display: block; padding-top: 5px; font-size: 1rem; }

        /* CONTROLES */
        .eval-bar { display: flex; gap: 20px; width: 100%; max-width: 750px; margin-top: 15px; }
        .btn-eval { padding: 12px; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; gap: 10px; border-radius: 10px; }
        .btn-bad { background: rgba(239,68,68,0.2); border: 2px solid var(--red); color: var(--red); }
        .btn-bad:hover { background: var(--red); color: white; }
        .btn-good { background: rgba(34,197,94,0.2); border: 2px solid var(--green); color: var(--green); }
        .btn-good:hover { background: var(--green); color: white; }

        .player-bar { display: flex; align-items: center; gap: 20px; margin-top: 15px; }
        .ctrl-btn { background: transparent; font-size: 3rem; color: #64748b; padding: 0; width: auto; flex:none; border:none; cursor: pointer;}
        .ctrl-btn:hover { color: white; transform: scale(1.1); }
        .play-btn { width: 70px; height: 70px; border-radius: 50%; background: var(--accent); color: black; font-size: 2.5rem; display: flex; align-items: center; justify-content: center; flex:none; box-shadow: 0 0 20px rgba(6, 182, 212, 0.4); border:none; cursor: pointer; }
        .play-active { background: var(--red); color: white; animation: pulse 1.5s infinite; }

        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999; justify-content:center; align-items:center; }
        .modal-box { background: var(--panel); padding: 25px; border-radius: 15px; width: 90%; max-width: 600px; border: 1px solid var(--accent); }
    </style>
</head>
<body>

<div class="layout">
    <div class="left-panel">
        <div class="brand">NEURO LINGUA V310</div>
        <div class="config-box">
            <span style="font-size:0.7rem; color:#aaa;">GUARDAR LISTA:</span>
            <div class="row">
                <input type="text" id="filename" placeholder="Ej: Verbos Irregulares">
                <button class="btn-green" onclick="saveList()">üíæ GUARDAR</button>
            </div>
            <span style="font-size:0.7rem; color:#aaa; margin-top:5px; display:block;">CARGAR LISTAS:</span>
            <div class="row">
                <select id="fileSelector"><option>-- Seleccionar --</option></select>
                <button class="btn-blue" onclick="loadList()">üìÇ ABRIR</button>
                <button class="btn-trash-small" onclick="deleteList()" title="Borrar">üóëÔ∏è</button>
            </div>
            <div class="row" style="margin-top:10px;">
                <input type="file" id="jsonInput" accept=".json" style="display:none" onchange="importJSON(this)">
                <button class="btn-purple" onclick="document.getElementById('jsonInput').click()">üì§ IMPORTAR</button>
                <button class="btn-orange" onclick="generatePDF()">üìÑ PDF</button>
            </div>
        </div>
        <div class="config-box">
            <div class="row">
                <button class="btn-purple" onclick="openModal()">üìù PEGAR TEXTO</button>
                <button class="btn-red" onclick="clearAll()">üßπ VACIAR PANTALLA</button>
            </div>
            <div class="row" style="margin-top:10px;">
                <select id="voiceEn"><option>Voz Ingl√©s...</option></select>
                <select id="voiceEs"><option>Voz Espa√±ol...</option></select>
            </div>
        </div>
        <div class="list-header"><span>PALABRAS (<span id="totalCount">0</span>)</span><span id="redCountText" style="color:var(--red)">0 Rojas</span></div>
        <div id="visualList" class="words-list-container"></div>
    </div>

    <div class="right-panel">
        <div class="top-review-bar"><button id="btnReview" class="btn-review-red" onclick="toggleReview()">üîÑ REPASAR ROJAS</button></div>
        <div class="flashcard">
            <div class="img-area"><img id="cardImg" class="real-img" src="https://via.placeholder.com/800x600?text=NeuroLingua" alt="Imagen"></div>
            <div class="info-area">
                <h1 id="wordEn" class="word-en">Ready?</h1>
                <div id="wordPho" class="word-pho">/r√©-di/</div>
                <div id="wordEs" class="word-es" contenteditable="true" onblur="saveEdit()">¬øListo?</div>
                <div class="sentence-area">
                    <span id="sentEn" class="sent-en">Your lists should appear on the left.</span>
                    <span id="sentEs" class="sent-es">Tus listas deber√≠an aparecer a la izquierda.</span>
                </div>
            </div>
        </div>
        <div class="eval-bar">
            <button class="btn-eval btn-bad" onclick="markWord('review')">‚ùå NO ME LA S√â</button>
            <button class="btn-eval btn-good" onclick="markWord('learned')">‚úÖ YA ME LA S√â</button>
        </div>
        <div class="player-bar">
            <button class="ctrl-btn" onclick="prevCard()">‚èÆÔ∏è</button>
            <button class="play-btn" id="btnPlay" onclick="togglePlay()">‚ñ∂</button>
            <button class="ctrl-btn" onclick="nextCard()">‚è≠Ô∏è</button>
            <div style="font-size:0.8rem; color:#aaa; margin-left:10px;">Ciclo: <select id="timerSelect" style="width:auto; padding:2px; display:inline-block;"><option value="3000">3s</option><option value="5000" selected>5s</option><option value="8000">8s</option><option value="10000">10s</option><option value="15000">15s</option></select></div>
        </div>
    </div>
</div>

<div id="modalLoad" class="modal">
    <div class="modal-box">
        <h3>Pegar Lista</h3>
        <p style="color:#aaa; font-size:0.8rem;">Se generar√°n oraciones √∫nicas autom√°ticamente.</p>
        <textarea id="bulkText" style="height:200px; background:#0f172a; color:white; border:1px solid #334155; padding:10px; width:100%; box-sizing: border-box;" placeholder="Pega aqu√≠..."></textarea>
        <div class="row" style="margin-top:10px;">
            <button class="btn-red" onclick="document.getElementById('modalLoad').style.display='none'">Cancelar</button>
            <button class="btn-green" onclick="processBulk()">CARGAR AHORA ‚ö°</button>
        </div>
    </div>
</div>

<script>
    let app = { fullList: [], activeList: [], index: 0, playing: false, timer: null, bgInterval: null, reviewing: false };

    // --- MOTOR DE CAOS (ORACIONES DIFERENTES SIEMPRE) ---
    const CHAOS_TEMPLATES = [
        {en:"Where did you find this [W]?", es:"¬øD√≥nde encontraste este/a [W]?"},
        {en:"The [W] is under the blue box.", es:"El/La [W] est√° debajo de la caja azul."},
        {en:"She lost her [W] at the airport.", es:"Ella perdi√≥ su [W] en el aeropuerto."},
        {en:"Nobody knows the secret of the [W].", es:"Nadie sabe el secreto del/la [W]."},
        {en:"Please, don't break the [W].", es:"Por favor, no rompas el/la [W]."},
        {en:"We need a bigger [W] for this.", es:"Necesitamos un/a [W] m√°s grande para esto."},
        {en:"My neighbor bought a golden [W].", es:"Mi vecino compr√≥ un/a [W] dorado/a."},
        {en:"Is that [W] dangerous?", es:"¬øEs ese/a [W] peligroso/a?"},
        {en:"I saw a giant [W] in my dream.", es:"Vi un/a [W] gigante en mi sue√±o."},
        {en:"The color of the [W] is strange.", es:"El color del/la [W] es extra√±o."},
        {en:"Without [W], we cannot finish.", es:"Sin [W], no podemos terminar."},
        {en:"Can you clean the [W], please?", es:"¬øPuedes limpiar el/la [W], por favor?"},
        {en:"The [W] fell from the table.", es:"El/La [W] se cay√≥ de la mesa."},
        {en:"Look! A flying [W]!", es:"¬°Mira! ¬°Un/a [W] volador/a!"},
        {en:"This [W] smells like vanilla.", es:"Este/a [W] huele a vainilla."},
        {en:"I forgot the [W] in the car.", es:"Olvid√© el/la [W] en el auto."},
        {en:"Who stole the [W]?", es:"¬øQui√©n rob√≥ el/la [W]?"},
        {en:"The [W] is hiding in the dark.", es:"El/La [W] se esconde en la oscuridad."},
        {en:"Never touch a burning [W].", es:"Nunca toques un/a [W] ardiendo."},
        {en:"Do you have a spare [W]?", es:"¬øTienes un/a [W] de repuesto?"},
        {en:"The price of the [W] went up.", es:"El precio del/la [W] subi√≥."},
        {en:"He threw the [W] into the river.", es:"√âl tir√≥ el/la [W] al r√≠o."},
        {en:"A small [W] appeared today.", es:"Un peque√±o [W] apareci√≥ hoy."},
        {en:"Your [W] looks very old.", es:"Tu [W] se ve muy viejo/a."},
        {en:"We don't sell [W] here.", es:"No vendemos [W] aqu√≠."},
        {en:"The [W] made a loud noise.", es:"El/La [W] hizo un ruido fuerte."},
        {en:"Why is the [W] wet?", es:"¬øPor qu√© est√° mojado/a el/la [W]?"},
        {en:"Give me that [W] immediately.", es:"Dame ese/a [W] inmediatamente."},
        {en:"The [W] is behind you!", es:"¬°El/La [W] est√° detr√°s de ti!"},
        {en:"I am painting a [W].", es:"Estoy pintando un/a [W]."},
        {en:"Have you seen my [W]?", es:"¬øHas visto mi [W]?"},
        {en:"The [W] is broken.", es:"El/La [W] est√° roto/a."},
        {en:"I like your [W].", es:"Me gusta tu [W]."},
        {en:"He needs a [W].", es:"√âl necesita un/a [W]."},
        {en:"The [W] is ready.", es:"El/La [W] est√° listo/a."},
        {en:"What is a [W]?", es:"¬øQu√© es un/a [W]?"},
        {en:"She hates [W].", es:"Ella odia [W]."},
        {en:"Buy a [W] now.", es:"Compra un/a [W] ahora."},
        {en:"No [W] allowed.", es:"No se permite [W]."},
        {en:"Test the [W].", es:"Prueba el/la [W]."}
    ];

    window.onload = () => {
        loadVoices();
        if(speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;
        updateFileSelector();
        
        // RECUPERAR SESI√ìN
        const saved = localStorage.getItem('NEO_V310_SESSION');
        if(saved) {
            try { app.fullList = JSON.parse(saved); app.activeList = app.fullList; } catch(e) {}
            renderVisualList(); updateCardUI(); startSmartTranslator(); checkRedButton();
        }
    };

    function openModal() { document.getElementById('modalLoad').style.display = 'flex'; }

    // --- CARGA ---
    function processBulk() {
        const txt = document.getElementById('bulkText').value;
        const lines = txt.split('\n');
        
        lines.forEach(line => {
            let w = line.replace(/^\d+[\.\)\-]?\s*/, '').trim(); 
            if(w.length > 1) {
                if(!app.fullList.some(x => x.en.toLowerCase() === w.toLowerCase())) {
                    
                    // ASIGNAR ESTRUCTURA √öNICA ALEATORIA
                    const t = CHAOS_TEMPLATES[Math.floor(Math.random() * CHAOS_TEMPLATES.length)];
                    const sEn = t.en.replace("[W]", w);
                    const sEs = t.es.replace("[W]", "..."); // Placeholder para palabra traducida

                    app.fullList.push({
                        en: w, 
                        es: "Traduc...", 
                        sentEn: sEn, // ORACI√ìN VARIADA DESDE EL INICIO
                        sentEs: sEs,
                        status: 'new',
                        img: `https://tse2.mm.bing.net/th?q=${encodeURIComponent(w)}+photography+hd&w=800&h=800&c=7&rs=1`
                    });
                }
            }
        });

        document.getElementById('modalLoad').style.display = 'none';
        document.getElementById('bulkText').value = "";
        
        app.activeList = app.fullList; 
        app.reviewing = false;
        
        renderVisualList(); updateCardUI(); saveSession(); startSmartTranslator(); checkRedButton();
    }

    // --- TRADUCTOR INTELIGENTE ---
    function startSmartTranslator() {
        if(app.bgInterval) clearInterval(app.bgInterval);
        
        app.bgInterval = setInterval(async () => {
            const item = app.fullList.find(x => x.es === "Traduc..." || x.sentEs === "Traduciendo oraci√≥n...");
            if(!item) { clearInterval(app.bgInterval); return; }
            
            try {
                // 1. Traducir palabra
                if(item.es === "Traduc...") {
                    const r1 = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=en&tl=es&dt=t&q=${encodeURIComponent(item.en)}`);
                    const j1 = await r1.json();
                    item.es = j1[0][0][0];
                }

                // 2. Completar la oraci√≥n ca√≥tica
                if(item.sentEs.includes("...")) {
                    item.sentEs = item.sentEs.replace("...", item.es);
                }

                if(app.activeList[app.index] === item) updateCardUI();
                renderVisualList(); saveSession();
            } catch(e) { console.log("API busy..."); }
        }, 1200);
    }

    // --- UI TARJETA ---
    function updateCardUI() {
        if(app.activeList.length === 0) {
            document.getElementById('wordEn').innerText = "...";
            return;
        }
        
        if(app.index >= app.activeList.length) app.index = 0;
        if(app.index < 0) app.index = app.activeList.length - 1;

        const item = app.activeList[app.index];
        
        document.getElementById('wordEn').innerText = item.en;
        document.getElementById('wordEs').innerText = (item.es === "Traduc..." ? "..." : item.es);
        document.getElementById('wordPho').innerText = `/${item.en.toLowerCase()}/`;
        
        document.getElementById('sentEn').innerText = item.sentEn;
        document.getElementById('sentEs').innerText = item.sentEs;
        document.getElementById('cardImg').src = item.img;

        const oldActive = document.querySelector('.list-item.active');
        if(oldActive) oldActive.classList.remove('active');
        const newActive = document.getElementById(`item-${app.index}`);
        if(newActive) {
            newActive.classList.add('active');
            newActive.scrollIntoView({block: "nearest", behavior: "smooth"});
        }

        if(app.playing) speakDual();
    }

    function renderVisualList() {
        const container = document.getElementById('visualList');
        container.innerHTML = '';
        document.getElementById('totalCount').innerText = app.activeList.length;

        app.activeList.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = `list-item ${idx === app.index ? 'active' : ''}`;
            div.id = `item-${idx}`;
            let dot = item.status === 'review' ? '<span class="status-dot dot-red"></span>' : (item.status === 'learned' ? '<span class="status-dot dot-green"></span>' : '');
            div.innerHTML = `<span>${idx+1}. ${item.en} ${dot}</span><span style="font-size:0.8rem; color:#aaa; font-style:italic;">${item.es.substring(0,10)}...</span>`;
            div.onclick = () => { app.index = idx; updateCardUI(); };
            container.appendChild(div);
        });
    }

    // --- GUARDADO H√çBRIDO ---
    function saveList() {
        const n = document.getElementById('filename').value.trim();
        if(!n) return alert("‚ö†Ô∏è Escribe nombre.");
        if(app.fullList.length === 0) return alert("‚ö†Ô∏è Lista vac√≠a.");
        try {
            const cleanList = app.fullList.map(item => ({ en: item.en, es: item.es, sentEn: item.sentEn, sentEs: item.sentEs, status: item.status }));
            localStorage.setItem('NEO_F_' + n, JSON.stringify(cleanList));
            updateFileSelector(); alert(`‚úÖ Lista "${n}" guardada.`);
        } catch(e) {
            downloadJSON(app.fullList, n); alert("‚ö†Ô∏è MEMORIA LLENA. Descargando archivo.");
        }
    }

    function downloadJSON(data, filename) {
        const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = `${filename}.json`;
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    }

    function importJSON(input) {
        const file = input.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const data = JSON.parse(e.target.result);
                app.fullList = data.map(item => ({ ...item, img: `https://tse2.mm.bing.net/th?q=${encodeURIComponent(item.en)}+photography+hd&w=800&h=800&c=7&rs=1` }));
                app.activeList = app.fullList; app.index = 0; app.reviewing = false;
                renderVisualList(); updateCardUI(); checkRedButton(); saveSession(); startSmartTranslator();
                alert("‚úÖ Respaldo cargado.");
            } catch(err) { alert("Archivo da√±ado."); }
        }; reader.readAsText(file); input.value = '';
    }

    function loadList() {
        const k = document.getElementById('fileSelector').value;
        if(k.startsWith('NEO_F_')) {
            if(confirm("¬øCargar?")) {
                try {
                    const data = JSON.parse(localStorage.getItem(k));
                    app.fullList = data.map(item => ({ ...item, img: `https://tse2.mm.bing.net/th?q=${encodeURIComponent(item.en)}+photography+hd&w=800&h=800&c=7&rs=1` }));
                    app.activeList = app.fullList; app.index = 0; app.reviewing = false;
                    updateCardUI(); renderVisualList(); checkRedButton(); saveSession(); startSmartTranslator();
                } catch(e) { alert("Error al cargar."); }
            }
        }
    }

    function deleteList() {
        const k = document.getElementById('fileSelector').value;
        if(k.startsWith('NEO_F_') && confirm("¬øBorrar?")) { localStorage.removeItem(k); updateFileSelector(); }
    }

    function updateFileSelector() {
        const s = document.getElementById('fileSelector'); s.innerHTML = '<option>-- Seleccionar --</option>';
        for(let i=0; i<localStorage.length; i++) {
            const k = localStorage.key(i);
            if(k.startsWith('NEO_F_')) {
                const o = document.createElement('option'); o.value = k; o.innerText = k.replace('NEO_F_',''); s.appendChild(o);
            }
        }
    }

    function markWord(status) {
        if(app.activeList.length === 0) return;
        app.activeList[app.index].status = status;
        saveSession(); renderVisualList(); checkRedButton();
        if(!app.playing) setTimeout(() => nextCard(), 500);
    }

    function toggleReview() {
        const btn = document.getElementById('btnReview');
        if(!app.reviewing) {
            const reds = app.fullList.filter(x => x.status === 'review');
            if(reds.length === 0) return alert("¬°No hay rojas!");
            app.activeList = reds; app.index = 0; app.reviewing = true;
            btn.innerText = "üîô VOLVER A TODAS"; btn.style.background = "#3b82f6";
        } else {
            app.activeList = app.fullList; app.index = 0; app.reviewing = false;
            btn.innerText = "üîÑ REPASAR ROJAS"; btn.style.background = "var(--red)";
        }
        updateCardUI(); renderVisualList();
    }

    function checkRedButton() {
        const reds = app.fullList.filter(x => x.status === 'review').length;
        const btn = document.getElementById('btnReview');
        document.getElementById('redCountText').innerText = `${reds} Rojas`;
        btn.style.display = (reds > 0 || app.reviewing) ? 'block' : 'none';
    }

    function speakDual() {
        window.speechSynthesis.cancel();
        const item = app.activeList[app.index];
        const vs = speechSynthesis.getVoices();
        
        const uEn = new SpeechSynthesisUtterance(item.en);
        uEn.voice = vs[document.getElementById('voiceEn').value];
        uEn.rate = 0.9;

        const uEs = new SpeechSynthesisUtterance(item.es);
        uEs.voice = vs[document.getElementById('voiceEs').value];
        uEs.rate = 1.1;

        window.speechSynthesis.speak(uEn);
        const p = new SpeechSynthesisUtterance(''); p.pause = 0.6; window.speechSynthesis.speak(p);
        if(item.es !== "Traduc...") window.speechSynthesis.speak(uEs);
    }

    function togglePlay() {
        if(app.playing) { app.playing=false; clearInterval(app.timer); document.getElementById('btnPlay').innerText="‚ñ∂"; window.speechSynthesis.cancel(); }
        else { if(app.activeList.length===0) return; app.playing=true; document.getElementById('btnPlay').innerText="‚è∏"; speakDual(); const ms=parseInt(document.getElementById('timerSelect').value); app.timer=setInterval(()=>{app.index++; updateCardUI();}, ms); }
    }
    function nextCard() { app.index++; updateCardUI(); speakDual(); }
    function prevCard() { app.index--; updateCardUI(); speakDual(); }
    function saveSession() { try { localStorage.setItem('NEO_V310_SESSION', JSON.stringify(app.fullList)); } catch(e){} }
    function clearAll() { if(confirm("¬øBorrar todo?")) { app.fullList=[]; app.activeList=[]; renderVisualList(); updateCardUI(); saveSession(); document.getElementById('cardImg').src=""; } }
    function saveEdit() { if(app.activeList.length>0) { app.activeList[app.index].es = document.getElementById('wordEs').innerText; saveSession(); } }

    function generatePDF() {
        if(app.activeList.length === 0) return alert("Nada que exportar");
        const doc = new window.jspdf.jsPDF();
        doc.setFontSize(18); doc.text("Profe Neo - Vocabulario", 10, 10); doc.setFontSize(12);
        let y = 20;
        app.activeList.forEach((item, i) => {
            if(y > 280) { doc.addPage(); y = 20; }
            doc.text(`${i+1}. ${item.en} - ${item.es}`, 10, y);
            y += 7;
        });
        doc.save('Lista.pdf');
    }

    function loadVoices() {
        const vs = speechSynthesis.getVoices();
        const e1 = document.getElementById('voiceEn'); const e2 = document.getElementById('voiceEs');
        e1.innerHTML=''; e2.innerHTML='';
        vs.forEach((v,i)=>{
            let o=document.createElement('option'); o.value=i; o.innerText=v.name;
            if(v.lang.includes('en-')) e1.appendChild(o.cloneNode(true));
            if(v.lang.includes('es-')) e2.appendChild(o.cloneNode(true));
        });
    }
</script>
</body>
</html>
