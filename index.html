<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-title" content="Profe Ingl√©s">
    
    <title>NeuroLingua V310 - Profe Ingl√©s</title>

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='100' fill='%238b5cf6'/><rect x='60' y='60' width='392' height='220' rx='15' fill='%231e293b' stroke='%23475569' stroke-width='10'/><text x='256' y='200' font-family='Arial, sans-serif' font-weight='900' font-size='110' fill='white' text-anchor='middle'>ABC</text><circle cx='256' cy='340' r='70' fill='%23f1f5f9'/><path d='M146 512 Q256 400 366 512' fill='%23334155'/><line x1='310' y1='420' x2='390' y2='200' stroke='%23f59e0b' stroke-width='15' stroke-linecap='round'/></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><rect width='512' height='512' rx='100' fill='%238b5cf6'/><rect x='60' y='60' width='392' height='220' rx='15' fill='%231e293b' stroke='%23475569' stroke-width='10'/><text x='256' y='200' font-family='Arial, sans-serif' font-weight='900' font-size='110' fill='white' text-anchor='middle'>ABC</text><circle cx='256' cy='340' r='70' fill='%23f1f5f9'/><path d='M146 512 Q256 400 366 512' fill='%23334155'/><line x1='310' y1='420' x2='390' y2='200' stroke='%23f59e0b' stroke-width='15' stroke-linecap='round'/></svg>">

    <script>
        const myManifest = {
            "name": "NeuroLingua Profe Ingl√©s",
            "short_name": "Profe Ingl√©s",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#0f172a",
            "theme_color": "#8b5cf6",
            "icons": [{
                "src": "https://cdn-icons-png.flaticon.com/512/3426/3426224.png",
                "sizes": "512x512",
                "type": "image/png"
            }]
        };
        const blob = new Blob([JSON.stringify(myManifest)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';</script>

    <style>
        :root {
            --primary: #8b5cf6; --accent: #06b6d4; --dark: #0f172a; --panel: #1e293b;
            --text: #f1f5f9; --green: #22c55e; --red: #ef4444;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--dark); color: var(--text); margin: 0; height: 100vh; display: flex; overflow: hidden; }
        .layout { display: flex; width: 100%; height: 100%; }
        
        /* IZQUIERDA */
        .left-panel { width: 400px; background: var(--panel); border-right: 1px solid #334155; display: flex; flex-direction: column; padding: 15px; gap: 10px; }
        .brand { font-size: 1.4rem; font-weight: 900; color: var(--accent); text-align: center; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 2px;}
        .config-box { background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px; border: 1px solid #334155; }
        .row { display: flex; gap: 5px; margin-bottom: 5px; align-items: center; }
        input, select { background: #0f172a; color: white; border: 1px solid #475569; padding: 8px; border-radius: 4px; width: 100%; font-size: 0.85rem; }
        button { cursor: pointer; padding: 8px; border-radius: 4px; border: none; font-weight: bold; color: white; font-size: 0.8rem; transition: 0.2s; flex: 1; }
        
        @media (max-width: 768px) {
            .left-panel { width: 100%; display: none; } /* En m√≥vil se oculta el panel lateral para dar espacio */
            .right-panel { width: 100%; }
        }

        /* LISTA */
        .words-list-container { flex: 1; overflow-y: auto; background: #0f172a; border: 1px solid #334155; border-radius: 5px; padding: 5px; }
        .list-item { padding: 8px 10px; border-bottom: 1px solid #1e293b; font-size: 0.9rem; display: flex; justify-content: space-between; cursor: pointer; align-items: center; }
        .list-item.active { background: var(--primary); color: white; }

        /* DERECHA */
        .right-panel { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; position: relative; }
        .flashcard { width: 100%; max-width: 750px; height: 80vh; background: #1e293b; border: 1px solid #334155; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7); }
        .img-area { flex: 4; background: #000; display: flex; align-items: center; justify-content: center; }
        .real-img { width: 100%; height: 100%; object-fit: contain; }
        .info-area { flex: 3; padding: 10px 30px; text-align: center; }
        .word-en { font-size: 3.5rem; font-weight: 900; margin: 0; color: white; }
        .word-es { font-size: 2.2rem; color: var(--accent); margin: 5px 0; font-weight: bold; }

        /* CONTROLES */
        .eval-bar { display: flex; gap: 20px; width: 100%; max-width: 750px; margin-top: 15px; }
        .btn-green { background: var(--green); } .btn-red { background: var(--red); }
        .btn-purple { background: var(--primary); } .btn-blue { background: #3b82f6; }

        .player-bar { display: flex; align-items: center; gap: 20px; margin-top: 15px; }
        .play-btn { width: 70px; height: 70px; border-radius: 50%; background: var(--accent); color: black; font-size: 2.5rem; display: flex; align-items: center; justify-content: center; border:none; cursor: pointer; }
    </style>
</head>
<body>

<div class="layout">
    <div class="left-panel">
        <div class="brand">NEURO LINGUA V310</div>
        <div class="config-box">
            <div class="row">
                <input type="text" id="filename" placeholder="Nombre de lista">
                <button class="btn-green" onclick="saveList()">üíæ GUARDAR</button>
            </div>
            <div class="row">
                <select id="fileSelector"><option>-- Cargar Lista --</option></select>
                <button class="btn-blue" onclick="loadList()">üìÇ ABRIR</button>
            </div>
        </div>
        <div class="config-box">
            <button class="btn-purple" onclick="openModal()">üìù PEGAR TEXTO</button>
            <div class="row" style="margin-top:10px;">
                <select id="voiceEn"><option>Voz Ingl√©s...</option></select>
                <select id="voiceEs"><option>Voz Espa√±ol...</option></select>
            </div>
        </div>
        <div id="visualList" class="words-list-container"></div>
    </div>

    <div class="right-panel">
        <div class="flashcard">
            <div class="img-area"><img id="cardImg" class="real-img" src="https://via.placeholder.com/800x600?text=NeuroLingua" alt="Imagen"></div>
            <div class="info-area">
                <h1 id="wordEn" class="word-en">Ready?</h1>
                <div id="wordEs" class="word-es" contenteditable="true">¬øListo?</div>
                <div style="color: #94a3b8; font-style: italic;">
                    <span id="sentEn">Let's start learning!</span><br>
                    <span id="sentEs" style="font-size: 1rem;">¬°Empecemos a aprender!</span>
                </div>
            </div>
        </div>
        <div class="eval-bar">
            <button class="btn-red" onclick="markWord('review')">‚ùå NO ME LA S√â</button>
            <button class="btn-green" onclick="markWord('learned')">‚úÖ YA ME LA S√â</button>
        </div>
        <div class="player-bar">
            <button onclick="prevCard()" style="background:none; font-size:2rem; color:white;">‚èÆÔ∏è</button>
            <button class="play-btn" id="btnPlay" onclick="togglePlay()">‚ñ∂</button>
            <button onclick="nextCard()" style="background:none; font-size:2rem; color:white;">‚è≠Ô∏è</button>
        </div>
    </div>
</div>

<div id="modalLoad" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:999; justify-content:center; align-items:center;">
    <div style="background:var(--panel); padding:25px; border-radius:15px; width:90%; max-width:500px; border:1px solid var(--accent);">
        <h3>Pegar Lista de Palabras</h3>
        <textarea id="bulkText" style="height:200px; width:100%; background:#0f172a; color:white; border:1px solid #334155; padding:10px;" placeholder="Ejemplo:&#10;Apple&#10;House&#10;Car"></textarea>
        <div class="row" style="margin-top:10px;">
            <button class="btn-red" onclick="document.getElementById('modalLoad').style.display='none'">Cancelar</button>
            <button class="btn-green" onclick="processBulk()">CARGAR ‚ö°</button>
        </div>
    </div>
</div>

<script>
    let app = { fullList: [], index: 0, playing: false };

    window.onload = () => {
        loadVoices();
        if(speechSynthesis.onvoiceschanged !== undefined) speechSynthesis.onvoiceschanged = loadVoices;
        updateFileSelector();
    };

    function openModal() { document.getElementById('modalLoad').style.display = 'flex'; }

    function processBulk() {
        const txt = document.getElementById('bulkText').value;
        const lines = txt.split('\n');
        lines.forEach(w => {
            w = w.trim();
            if(w.length > 1) {
                app.fullList.push({
                    en: w, es: "Traduciendo...", 
                    sentEn: "I am using the " + w, sentEs: "Estoy usando el/la " + w,
                    img: `https://tse2.mm.bing.net/th?q=${encodeURIComponent(w)}+photography&w=800&h=800&c=7`
                });
            }
        });
        document.getElementById('modalLoad').style.display = 'none';
        renderVisualList();
        updateCardUI();
    }

    function updateCardUI() {
        if(app.fullList.length === 0) return;
        const item = app.fullList[app.index];
        document.getElementById('wordEn').innerText = item.en;
        document.getElementById('wordEs').innerText = item.es;
        document.getElementById('sentEn').innerText = item.sentEn;
        document.getElementById('sentEs').innerText = item.sentEs;
        document.getElementById('cardImg').src = item.img;
        renderVisualList();
    }

    function renderVisualList() {
        const container = document.getElementById('visualList');
        container.innerHTML = '';
        app.fullList.forEach((item, idx) => {
            const div = document.createElement('div');
            div.className = `list-item ${idx === app.index ? 'active' : ''}`;
            div.innerHTML = `<span>${idx+1}. ${item.en}</span>`;
            div.onclick = () => { app.index = idx; updateCardUI(); };
            container.appendChild(div);
        });
    }

    function togglePlay() {
        if(app.playing) { app.playing=false; document.getElementById('btnPlay').innerText="‚ñ∂"; }
        else { app.playing=true; document.getElementById('btnPlay').innerText="‚è∏"; autoPlay(); }
    }

    function autoPlay() {
        if(!app.playing) return;
        speak();
        setTimeout(() => { if(app.playing) { nextCard(); autoPlay(); } }, 5000);
    }

    function speak() {
        const item = app.fullList[app.index];
        const utterance = new SpeechSynthesisUtterance(item.en);
        utterance.lang = 'en-US';
        window.speechSynthesis.speak(utterance);
    }

    function nextCard() { app.index = (app.index + 1) % app.fullList.length; updateCardUI(); }
    function prevCard() { app.index = (app.index - 1 + app.fullList.length) % app.fullList.length; updateCardUI(); }

    function loadVoices() {
        const vs = speechSynthesis.getVoices();
        const e1 = document.getElementById('voiceEn');
        e1.innerHTML = '';
        vs.forEach((v, i) => {
            if(v.lang.includes('en')) {
                let o = document.createElement('option'); o.value = i; o.innerText = v.name; e1.appendChild(o);
            }
        });
    }

    // ACTIVADOR DE INSTALACI√ìN
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('data:application/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdmZXRjaCcsIGZ1bmN0aW9uKGV2ZW50KSB7fSk7');
    }
</script>
</body>
</html>
